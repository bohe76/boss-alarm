# 보스 알리미 시스템 아키텍처 문서 (v2.1 - SSOT & Reconstruction 적용)

## 1. 개요

본 문서는 "보스 알리미" 웹 애플리케이션의 리뉴얼된 시스템 아키텍처를 설명합니다. 이 애플리케이션은 게임 보스 출현 시간을 사용자에게 알리고, 보스 목록을 공유할 수 있는 클라이언트 측 웹 애플리케이션입니다. 기존 단일 화면 구성에서 메뉴 기반의 다중 화면 레이아웃으로 전환하여 사용자 경험을 개선하고 기능별 분리를 강화했습니다. 특히 v2.1에서는 데이터 무결성을 위해 SSOT(Single Source of Truth) 원칙을 도입하고 데이터 재구성(Reconstruction) 전략을 적용했습니다.

## 2. 아키텍처 개요

애플리케이션은 `src/app.js`를 최초 진입점으로 하는 클라이언트 측 단일 페이지 애플리케이션(SPA)입니다. HTML5, CSS3, 바닐라 JavaScript (ES Modules), 웹 음성 API (`window.speechSynthesis`), TinyURL API 등의 기술 스택으로 구성됩니다.

UI는 핵심적으로 **헤더, 내비게이션 메뉴 (사이드바), 메인 콘텐츠 영역, 푸터, 그리고 모바일 뷰를 위한 하단 탭 바**의 5가지 주요 영역으로 나뉘며, JavaScript 코드는 기능별로 `src/` 폴더 내의 여러 ES Modules로 분리되어 각 모듈은 명확한 책임을 가집니다. `src/app.js`는 애플리케이션의 전반적인 초기화, 상태 관리 및 라우팅을 담당하는 최상위 오케스트레이터 역할을 수행합니다. 메인 콘텐츠 영역은 `src/router.js`와 `src/ui-renderer.js`를 통해 선택된 메뉴 항목에 따라 다른 화면을 동적으로 렌더링합니다. 모바일 뷰에서는 기존 사이드바가 '더보기' 메뉴 오버레이로 재활용됩니다.

## 3. 주요 기능

*   **보스 목록 관리:** 사용자는 텍스트 영역에 `HH:MM 보스이름` 형식으로 보스 출현 시간과 이름을 입력할 수 있습니다. 입력 후 "보스 설정 저장" 버튼을 클릭하여 명시적으로 저장해야 하며, 이때 데이터 파싱, 유효성 검사, 정렬이 수행되어 데이터 무결성을 보장합니다.
*   **시간 기반 알림:** 보스 출현 5분 전, 1분 전, 0분 전에 오디오 및 시각적(로그) 알림이 트리거됩니다.
*   **오디오 알림:** 웹 음성 API (`window.speechSynthesis`)를 활용하여 음성 알림을 제공합니다. 음소거 설정이 가능합니다.
*   **로깅:** 트리거된 모든 알림 및 시스템 메시지 로그를 표시합니다.
*   **공유 가능한 URL:** 현재 보스 목록을 인코딩하여 다른 사용자를 위해 미리 채워주는 짧은 URL(TinyURL API를 통해)을 생성합니다.
*   **젠/광 계산기:** 보스 리젠 시간을 계산하는 유틸리티 기능을 제공합니다.

## 4. 기술 스택 상세

*   **HTML5 / CSS3:** 웹 표준 마크업 및 스타일링. CSS는 `src/style.css` 외부 파일로 링크됩니다.
*   **바닐라 JavaScript (ES Modules):** 프레임워크 없이 순수 JavaScript를 사용하여 모듈화된 형태로 개발되었습니다. `src/` 폴더 내에서 기능별로 분리된 모듈들을 `import`하여 사용합니다.
*   **데이터 관리 (SSOT & Reconstruction):**
    *   `BossDataManager`를 데이터의 유일한 진실 공급원(SSOT)으로 사용합니다.
    *   모든 데이터 변경(입력, 수정, 업데이트) 시 **Reconstruction(재구성) 전략**을 사용하여 데이터를 날짜순/시간순으로 정렬하고, 날짜 마커를 적절한 위치에 자동으로 삽입하여 저장합니다. 이를 통해 날짜 꼬임이나 데이터 중복 문제를 원천적으로 방지합니다.
    *   보스 객체는 고유 ID를 통해 식별되며, 이름 중복 시에도 안전하게 업데이트됩니다.
*   **Web Speech API (`window.speechSynthesis`):** 음성 알림 기능을 구현하는 데 사용됩니다.
*   **TinyURL API:** 공유 가능한 짧은 URL을 생성하는 데 사용됩니다.
*   **비동기 처리:** `fetch` API 및 `async/await` 문법을 활용하여 TinyURL API 호출, JSON 파일 로드, 클립보드 작업 등 비동기 작업을 효율적으로 처리합니다.
*   **Local Storage:** `LocalStorageManager`를 통해 사용자 설정(고정 알림, 음소거 상태, 사이드바 확장 상태 등) 및 사용자 지정 데이터(광 계산기 기록 등)를 브라우저에 영구적으로 저장합니다.

## 5. 애플리케이션 빌드 및 실행

이 프로젝트는 클라이언트 측 웹 애플리케이션으로, HTML, CSS, JavaScript 모듈로 구성됩니다. 특별한 빌드 단계나 서버 측 구성 요소는 필요하지 않습니다.

**애플리케이션 실행 방법:**
1.  `index.html` 파일을 최신 웹 브라우저(예: Chrome, Firefox, Edge)에서 엽니다.
2.  **참고:** `file://` 프로토콜로 `index.html`을 직접 열 경우, 일부 브라우저에서 보안상의 이유로 `fetch` 요청(예: TinyURL API 호출, 도움말 문서 로드)이 CORS 오류로 실패할 수 있습니다. 모든 기능을 정상적으로 사용하려면, 로컬 웹 서버(예: VS Code Live Server 확장)를 사용하여 애플리케이션을 실행하는 것을 권장합니다.

## 6. 테스트 환경

코드 품질을 보장하고, 회귀를 방지하며, 안정적인 리팩토링 프로세스를 촉진하기 위해 이 프로젝트는 테스트 프레임워크로 **Vitest**를 도입했습니다.

*   **테스트 디렉터리:** 모든 유닛 테스트 파일은 프로젝트 루트의 `test/` 디렉터리에 위치합니다. 이 디렉터리 내의 테스트 파일은 `*.test.js` 명명 규칙을 따릅니다.
*   **테스트 범위:** 현재 다음 핵심 모듈에 대한 유닛 테스트가 포함되어 있습니다.
    *   `src/utils.js`: 범용 유틸리티 함수
    *   `src/calculator.js`: 젠 계산기 로직
    *   `src/boss-parser.js`: 보스 목록 파싱 및 정렬 로직
    *   `src/light-calculator.js`: 광 계산기 로직
    *   `src/custom-list-manager.js`: 사용자 지정 보스 목록 관리 로직
*   **프레임워크:** [Vitest](https://vitest.dev/) - Vite 프로젝트와 호환되는 최신의 빠르고 기능이 풍부한 테스트 프레임워크이지만, ES 모듈을 사용하는 바닐라 JavaScript 프로젝트에서도 훌륭하게 작동합니다.
*   **환경:** [JSDOM](https://jsdom.github.io/) - 테스트 환경은 Node.js 환경 내에서 가상 DOM 구현을 제공하는 JSDOM을 사용하도록 구성되어 있습니다. 이를 통해 전체 브라우저 인스턴스를 실행할 필요 없이 DOM 조작 및 브라우저와 유사한 동작을 테스트할 수 있습니다.
*   **구성:**
    *   테스트 설정은 `vitest.config.js`에 정의되어 있습니다.
    *   `globals`가 활성화되어(`globals: true`) 일반적인 테스트 함수(`describe`, `it`, `expect`, `vi`)를 명시적인 가져오기 없이 모든 테스트 파일에서 사용할 수 있습니다.
*   **실행:**
    *   테스트는 `package.json`에 정의된 `npm test` 스크립트를 사용하여 실행할 수 있습니다.
    *   **참고:** 만약 PowerShell 실행 정책(Execution Policy) 문제로 `npm test` 명령이 실패하는 경우, 다음 명령어를 대신 사용할 수 있습니다.
        ```shell
        node ./node_modules/vitest/dist/cli.js run
        ```
    *   이는 애플리케이션의 로직을 검증하고 새로운 변경으로 인한 의도하지 않은 부작용을 방지하는 표준화된 방법을 제공합니다.

## 7. 프로젝트 의존성 관리

프로젝트의 의존성은 Node.js 패키지 매니저인 npm을 통해 관리됩니다. `package-lock.json` 파일은 프로젝트의 모든 직접 및 전이 의존성에 대한 정확한 버전 정보를 기록합니다. 이는 모든 개발 환경에서 일관된 의존성 설치를 보장하고, 의존성 업데이트로 인한 잠재적인 문제를 방지하는 데 필수적입니다.

*   **`package.json`**: 프로젝트의 직접적인 의존성(dependencies)과 개발 의존성(devDependencies)을 명시합니다.
*   **`package-lock.json`**: `npm install` 명령 실행 시 생성/업데이트되며, 모든 패키지의 정확한 버전, 출처, 무결성 정보를 기록합니다. 이 파일은 `git`에 커밋되어 팀 전체의 일관된 개발 환경을 유지하는 데 사용됩니다.

## 8. 모듈별 상세 설명
애플리케이션을 구성하는 각 모듈의 역할과 주요 기능에 대한 자세한 내용은 [모듈 상세 문서](system_module_details_v2.md)를 참조하십시오.

## 9. 모듈 간 의존성
애플리케이션을 구성하는 모듈 간의 상세한 의존성 관계는 [모듈 의존성 문서](system_module_dependencies_v2.md)를 참조하십시오.

## 10. 데이터 흐름
애플리케이션의 주요 데이터 흐름 및 각 모듈 간의 상호작용에 대한 상세 내용은 [데이터 흐름 문서](system_data_flow_v2.md)를 참조하십시오.