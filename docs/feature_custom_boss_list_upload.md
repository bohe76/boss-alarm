# 기능 명세서: 보스 스케줄러용 사용자 지정 보스 목록 업로드

## 1. 서론

본 문서는 사용자가 보스 스케줄러에 사용자 지정 보스 이름 목록을 사용자 지정할 수 있는 새로운 기능의 구현을 상세히 설명합니다. 이 기능은 모달 내 텍스트 영역을 통해 보스 목록을 입력받아 미리 정의된 게임 목록 외에 사용자가 자신만의 보스 목록을 정의하고 관리할 수 있도록 함으로써 유연성을 향상시킵니다.

## 2. 사용자 스토리

*   사용자는 보스 스케줄러에서 자신만의 사용자 지정 보스 목록을 사용할 수 있도록 보스 이름 목록이 포함된 텍스트를 입력하여 보스 목록을 생성하고 싶습니다.
*   사용자는 게임 선택 드롭다운에서 자신의 사용자 지정 보스 목록을 쉽게 식별할 수 있도록 이름을 지정하고 싶습니다.
*   사용자는 입력한 텍스트 형식이 유효하지 않은 경우 (줄 번호 포함) 특정 오류 메시지를 통해 알림을 받아 쉽게 수정하고 싶습니다.
*   사용자는 세션 간에 유지되도록 입력한 사용자 지정 보스 목록이 로컬에 저장되기를 원합니다.
*   사용자는 보스 스케줄러의 "게임 선택" 드롭다운에서 자신의 사용자 지정 보스 목록을 선택할 수 있기를 원합니다.
*   사용자는 자신의 사용자 지정 보스 목록을 삭제할 수 있기를 원합니다.
*   사용자는 자신의 사용자 지정 보스 목록의 이름을 변경할 수 있기를 원합니다.

## 3. UI/UX 디자인

### 3.1. 보스 스케줄러 화면 (`boss-scheduler-screen`)

`boss-scheduler-screen`에 커스텀 보스 관리 기능이 추가되며, 이는 '커스텀 보스 관리' 버튼을 통해 접근하는 모달 형태로 제공됩니다.

#### 3.1.1. 커스텀 보스 관리 버튼

이 버튼을 통해 사용자는 사용자 지정 보스 목록을 추가, 수정, 삭제, 이름 변경할 수 있는 모달을 엽니다.

*   **버튼: "커스텀 보스 관리"**
    *   동작: "커스텀 보스 관리 모달"을 엽니다.

#### 3.1.2. 커스텀 보스 관리 모달

"커스텀 보스 관리" 버튼을 클릭하면 나타나는 모달입니다.

*   **모달 제목:** "커스텀 보스 관리"
*   **탭 또는 섹션:**
    *   **"목록 추가" 탭/섹션:**
        *   **입력 필드: "사용자 지정 목록 이름"**
            *   유형: 텍스트 입력.
            *   플레이스홀더: "새 목록 이름 입력"
            *   유효성 검사: 필수, 고유 (기존 미리 정의된 게임 또는 다른 사용자 지정 목록과 동일할 수 없음). 문자 제한 (영문 대소문자, 한글, 숫자, 공백, 하이픈(-), 밑줄(_), 괄호()만 허용, 50자 이내).
        *   **텍스트 영역: "보스 목록 내용"**
            *   유형: 여러 줄 텍스트 입력.
            *   플레이스홀더: "보스 이름을 한 줄에 하나씩 입력하세요. 
            *   유효성 검사: 비어 있을 수 없음. 각 줄은 보스 이름 문자 제한을 준수해야 합니다.
        *   **버튼: "저장"**
            *   동작: 입력된 이름과 내용으로 새 사용자 지정 목록을 저장합니다. 유효성 검사 실패 시 오류 메시지를 표시합니다.
    *   **"목록 관리" 탭/섹션:**
        *   로컬에 저장된 모든 사용자 지정 보스 목록을 표시합니다.
        *   각 사용자 지정 목록 항목은 다음을 표시합니다.
            *   **목록 이름** (예: "아이온 2")
            *   **버튼: "수정"**
                *   동작: 해당 목록의 이름과 내용을 "목록 추가" 탭/섹션에 미리 채우고, 사용자가 수정 후 저장할 수 있도록 합니다.
            *   **버튼: "이름 변경"**
                *   동작: 사용자에게 새 이름을 입력하라는 프롬프트 대화 상자(예: `prompt()`)를 표시합니다. 새 이름은 기존 미리 정의된 게임 이름 또는 다른 사용자 지정 목록 이름과 중복될 수 없습니다. 유효성 검사 실패 시 오류 메시지를 표시합니다.
            *   **버튼: "삭제"**
                *   동작: 확인 메시지를 표시한 다음 사용자 지정 목록을 삭제합니다.
*   **모달 상단 우측:**
    *   **버튼: "닫기"**
        *   동작: 모달을 닫습니다.
        *   모달 제목과 같은 줄에 있습니다.

#### 3.1.3. 저장된 사용자 지정 목록 표시 (메인 화면)

메인 화면의 "커스텀 보스 관리" 섹션 아래에 로컬에 저장된 모든 사용자 지정 보스 목록이 표시됩니다.

*   각 사용자 지정 목록 항목은 다음을 표시합니다.
    *   **목록 이름** (예: "아이온 2")
    *   **버튼: "선택"**
        *   동작: "게임 선택" 드롭다운에서 이 사용자 지정 목록을 선택하고, 해당 보스 목록으로 보스 스케줄러의 입력 필드를 즉시 채웁니다.

### 3.2. 게임 선택 드롭다운 (`#gameSelect`)

*   드롭다운은 미리 정의된 게임 이름 (`data/boss_lists.json`에서)과 사용자 정의 사용자 지정 목록 이름 (로컬 저장소에서)으로 채워집니다.
*   사용자 지정 목록 이름은 시각적으로 구별할 수 있습니다 (예: 이름 앞에 "*"이 추가됨).
*   **충돌 해결:** 사용자 지정 목록 이름이 미리 정의된 게임 이름과 충돌하는 경우, 사용자 지정 목록은 "*사용자지정목록이름"으로 표시됩니다.

## 4. 기능 요구 사항

### 4.1. 사용자 지정 목록 추가/수정 및 파싱

*   사용자는 텍스트 영역에 보스 목록 내용을 직접 입력합니다.
*   텍스트 영역의 내용은 각 줄에 하나의 보스 이름이 있는 목록이어야 합니다.
*   빈 줄 또는 공백만 포함하는 줄은 무시됩니다.
*   각 유효한 줄은 앞뒤 공백이 제거됩니다.
*   **보스 이름 문자 제한:** 보스 이름은 일부 특수 문자를 포함할 수 있으나, 내부 데이터 구조를 손상시킬 수 있는 제어 문자(예: `\n`, `\r`, `\t`)는 허용되지 않습니다. 길이는 50자를 초과할 수 없습니다.

### 4.2. 유효성 검사 및 오류 처리

*   **빈 사용자 지정 목록 이름:** 사용자가 사용자 지정 목록 이름을 제공하지 않고 저장을 시도하면 "사용자 지정 목록 이름은 비워둘 수 없습니다."라는 오류 메시지가 표시됩니다.
*   **중복 사용자 지정 목록 이름:** 제공된 사용자 지정 목록 이름이 이미 존재하는 경우, 저장 시 덮어쓰기 확인 대화 상자를 표시합니다. 이름 변경 시에는 "이미 존재하는 이름입니다. 다른 이름을 입력해주세요."와 같은 오류 메시지를 요구합니다.
*   **유효하지 않은 사용자 지정 목록 이름 (문자/길이 제한):** 사용자 지정 목록 이름이 문자 제한을 위반하거나 길이가 50자를 초과하는 경우, "사용자 지정 목록 이름은 영문 대소문자, 한글, 숫자, 공백, 하이픈(-), 밑줄(_), 괄호()만 허용하며, 50자를 초과할 수 없습니다."와 같은 구체적인 오류 메시지가 표시됩니다.
*   **빈 보스 목록 내용:** 보스 목록 내용이 비어 있으면 "보스 목록 내용이 비어 있습니다."라는 오류 메시지가 표시됩니다.
*   **유효하지 않은 보스 목록 내용:** 보스 목록 내용에 유효한 보스 이름이 아닌 줄이 포함된 경우 (예: 정의된 문자 제한을 초과하거나 제어 문자를 포함하는 경우), 특정 오류 메시지가 기록되고 사용자에게 표시됩니다. 오류 메시지에는 해당 줄 번호와 문제 있는 내용, 그리고 "허용되지 않는 문자가 포함되어 있습니다" 또는 "길이가 50자를 초과합니다"와 같이 유효하지 않은 이유가 명확히 포함됩니다.
*   **파싱 오류:** 내용 파싱 중 발생하는 모든 오류는 `logger.js`를 통해 포착되고 보고됩니다.
*   **오류 메시지 표시:** 오류 메시지는 `logger.js`를 통해 알림 로그 화면에 기록되며, 사용자에게 즉각적인 피드백을 제공하기 위해 보스 스케줄러 화면 상단에 임시 토스트/알림 메시지로도 표시됩니다.

### 4.3. 데이터 지속성

*   사용자 지정 보스 목록 (이름 및 파싱된 보스 이름 배열)은 `LocalStorageManager`에 저장됩니다.
*   별도의 키 (예: `customBossLists`)는 사용자 지정 목록 객체 배열을 저장하는 데 사용됩니다.

### 4.4. 보스 스케줄러와의 통합

*   "게임 선택" 드롭다운에서 사용자 지정 목록이 선택되면 보스 스케줄러의 입력 필드는 해당 사용자 지정 목록의 보스 이름으로 채워집니다.
*   남은 시간 및 출현 시간 계산을 위한 기존 로직은 사용자 지정 목록 보스에 적용됩니다.

## 5. 기술 설계

### 5.1. 새 모듈: `src/custom-list-manager.js`

*   **목적:** 사용자 지정 보스 목록 관리를 위한 모든 로직을 캡슐화합니다.
*   **종속성:** `LocalStorageManager`, `logger.js`.
*   **공개 API:**
    *   `init()`: 앱 시작 시 로컬 저장소에서 사용자 지정 목록을 로드합니다.
    *   `getCustomLists()`: 저장된 모든 사용자 지정 목록 객체 배열을 반환합니다.
    *   `addCustomList(listName, listContent)`: 텍스트 영역 내용을 파싱하고 유효성을 검사한 다음 새 사용자 지정 목록으로 저장합니다. 성공/실패 및 오류 세부 정보를 담은 객체(`{ success: boolean, message?: string }`)를 반환합니다.
    *   `updateCustomList(listName, newListContent)`: 기존 사용자 지정 목록의 내용을 업데이트합니다. 텍스트 영역 내용을 파싱하고 유효성을 검사합니다. 성공/실패 및 오류 세부 정보를 담은 객체(`{ success: boolean, message?: string }`)를 반환합니다.
    *   `deleteCustomList(listName)`: 사용자 지정 목록을 삭제합니다. 성공/실패 여부를 나타내는 boolean 값을 반환합니다.
    *   `renameCustomList(oldName, newName)`: 기존 사용자 지정 목록의 이름을 변경합니다. 새 이름의 유효성(고유성)을 검사합니다. 성공/실패 및 오류 세부 정보를 담은 객체(`{ success: boolean, message?: string }`)를 반환합니다.
    *   `getBossNamesForCustomList(listName)`: 특정 사용자 지정 목록의 보스 이름 배열을 반환합니다.
    *   `getCustomListContent(listName)`: 특정 사용자 지정 목록의 원본 텍스트 내용을 반환합니다 (수정 모달에 미리 채우기 위함).

### 5.2. `src/boss-scheduler-data.js` 수정

*   **목적:** 미리 정의된 보스 목록과 사용자 지정 보스 목록을 집계합니다.
*   **종속성:** `custom-list-manager.js`.
*   **수정 사항:**
    *   `loadBossLists()`: 이제 `custom-list-manager.js:init()`도 호출하고 사용자 지정 목록을 검색합니다.
    *   `getGameNames()`: 미리 정의된 게임 이름과 사용자 지정 목록 이름 (적절한 구별 포함)의 결합된 목록을 반환합니다.
    *   `getBossNamesForGame(gameName)`: `gameName`이 미리 정의된 게임인지 또는 사용자 지정 목록인지 확인하고 해당 보스 이름을 반환합니다.

### 5.3. `src/ui-renderer.js` 수정

*   **목적:** 사용자 지정 목록 관리를 위한 새로운 UI 요소를 렌더링합니다.
*   **수정 사항:**
    *   `renderBossSchedulerScreen()`: 커스텀 보스 관리 기능의 진입점(버튼)과 모달 구조를 포함합니다.
    *   사용자 지정 목록 관리 모달의 "목록 추가" 탭/섹션 및 "저장된 목록 관리" 탭/섹션 콘텐츠를 렌더링하기 위한 새로운 도우미 함수.
    *   `renderBossInputs()`: 사용자 지정 목록의 보스 이름을 처리하도록 업데이트됩니다.

### 5.4. `src/event-handlers.js` 수정

*   **목적:** 새로운 UI 요소에 대한 이벤트 리스너를 연결합니다.
*   **수정 사항:**
    *   "사용자 지정 목록 관리" 버튼에 대한 이벤트 리스너 (모달 열기).
    *   모달 내 "목록 추가" 탭/섹션의 "저장" 버튼에 대한 이벤트 리스너 (`custom-list-manager.js:addCustomList` 또는 `updateCustomList` 호출).
    *   모달 내 "저장된 목록 관리" 탭/섹션의 각 목록 항목에 대한 "수정", "이름 변경", "삭제" 버튼에 대한 이벤트 리스너.
    *   모달 내 "닫기" 버튼에 대한 이벤트 리스너.

### 5.5. `src/style.css` 수정

*   입력 필드, 버튼 및 저장된 목록 표시를 포함하여 "사용자 지정 보스 목록 관리" 섹션에 대한 새로운 CSS 규칙.

## 6. 미해결 질문 / 향후 고려 사항

*   사용자가 저장할 수 있는 사용자 지정 보스 목록의 최대 개수는 현재 제한이 없습니다.
*   향후 다른 파일 형식 (예: CSV) 지원은 고려하지 않습니다.
