### 푸시 알림 시스템 기능 명세서 (최종안)

#### 1. 목표
*   브라우저가 닫혀 있거나 최소화된 상태에서도 사용자가 보스 출현 알림을 안정적으로 받을 수 있도록 한다.

#### 2. 핵심 기술
*   **플랫폼:** **Vercel** (웹사이트 호스팅, 서버리스 함수) + **OneSignal** (푸시 알림 전문 서비스)
*   **비용:** 모든 기능은 선택한 플랫폼들의 **무료 등급(Free Tier)** 내에서 운영 가능하도록 설계한다.

#### 3. 주요 개념 정의
*   **스케줄(Schedule):** 관리자가 특정 시점에 설정한 '동적 보스 목록'과 '고정 알림 목록'을 합친 **하나의 완전한 알람 데이터 묶음**.
*   **스케줄 ID(Schedule ID):** 각각의 '스케줄'을 식별하기 위한 고유 ID.
*   **공유 링크:** `?scheduleId=[ID]` 형식의 링크. 일반 사용자를 위한 **보기 전용** 링크이다.
*   **관리자 링크:** `?scheduleId=[ID]&adminKey=[Secret]` 형식의 링크. 스케줄을 수정할 수 있는 **관리자 전용** 링크이다.

#### 4. 관리자 워크플로우
1.  **새 스케줄 생성:**
    *   앱의 기본 주소로 접속하여 '동적/고정 보스 목록'을 모두 설정한다.
    *   '발행' 버튼을 누르면, 서버는 새로운 `스케줄 ID`와 `adminKey`를 생성하여 '공유 링크'와 '관리자 링크'를 제공한다.
2.  **기존 스케줄 업데이트:**
    *   '관리자 링크'로 접속하여 '동적/고정 보스 목록'을 수정하고 '발행' 버튼을 누른다.
    *   서버는 `adminKey`를 확인 후, 기존 `스케줄 ID`의 데이터를 최신 내용으로 덮어쓴다.
    *   이때, 해당 스케줄의 **수명(TTL)이 다시 24시간으로 재설정**된다.

#### 5. 일반 사용자 워크플로우
1.  **최초 구독:**
    *   '공유 링크'로 접속한 뒤, 앱 내의 메인 ON/OFF 스위치를 처음 'ON'으로 켤 때 브라우저의 알림 허용을 요청한다.
    *   사용자가 '허용'하면, '푸시 구독 정보'가 현재의 '스케줄 ID'와 함께 서버에 저장된다.
2.  **알람 개인화 (음소거 기능):**
    *   '알림 설정' 화면에는 관리자가 설정한 **모든 보스 목록이 통합**되어 표시된다.
    *   사용자는 이 목록에서 원하지 않는 특정 보스 알람만 개별적으로 토글 버튼을 이용해 끌 수 있다. 이 설정은 서버에 저장되어 개인에게만 적용된다.

#### 6. 시스템 세부 동작
1.  **스케줄러:** 단 하나의 서버리스 함수가 1분마다 실행되며 모든 스케줄을 확인한다.
2.  **알림 발송:**
    *   알람 시간이 되면, 해당 스케줄을 구독한 사용자 중, 해당 보스를 음소거하지 않은 사용자에게만 푸시를 보낸다.
    *   여러 보스가 동시간대여도 **알림을 합치지 않고 개별적으로 발송**한다.
3.  **자동 삭제 (TTL):** **24시간** 동안 업데이트되지 않은 스케줄은 서버에서 **자동으로 삭제**된다.
4.  **스케줄 복구:** 삭제된 스케줄이라도 유효한 '관리자 링크'로 '발행'을 시도하면, 서버는 동일한 `스케줄 ID`로 스케줄을 다시 생성해준다(Upsert).
5.  **알림 클릭:** 사용자가 받은 푸시 알림을 클릭하면 앱이 열리거나 해당 탭으로 포커스가 이동된다.
6.  **음성 안내:** 앱이 완전히 꺼져 있을 때는 **시스템 기본 알림음**만 울리며, 음성 안내는 앱이 활성화된 상태에서만 지원된다.
