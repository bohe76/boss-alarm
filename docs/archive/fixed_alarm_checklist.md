### **고정 알림 요일별 반복 기능 구현 체크리스트 (v2 - UI/로직 구체화)**

#### **0. 작업 원칙: 분석 → 제안 → 컨펌 → 구현 → 검증 → 컨펌 → 커밋**

이 문서는 아래 7단계의 원칙에 따라 작업을 진행하여, 사이드 이펙트를 방지하고 안정적인 개발을 보장합니다.

1.  **[Agent] 사전 분석:** 각 항목의 '실행 계획'을 구현하기 전, 코드 베이스 전체에 미칠 영향을 분석하여 잠재적 문제를 파악합니다.
2.  **[Agent] 계획 제안:** 분석 결과를 바탕으로, 구체적인 실행 계획과 코드 변경안을 사용자에게 제안합니다.
3.  **[User] 계획 컨펌:** 사용자는 제안된 계획을 검토하고 최종 승인합니다.
4.  **[Agent] 구현:** 승인된 계획에 따라 코드를 수정합니다.
5.  **[Agent] 검증 요청:** 구현이 완료되면, 사용자에게 '검증'을 요청하고 대기합니다.
6.  **[User] 최종 컨펌:** 사용자는 구현된 내용을 직접 확인하고, 문제가 없으면 커밋을 포함한 최종 진행을 승인(컨펌)합니다.
7.  **[Agent] 커밋:** 사용자의 최종 컨펌 후, 해당 단계의 변경사항을 커밋합니다.

---

#### **1.0 개요 및 전략**

이 문서는 고정 알림(Fixed Alarm)에 **요일별 반복 설정** 기능을 추가하기 위한 실행 계획입니다.

*   **목표:** 유저가 특정 요일에만 알림이 울리도록 설정할 수 있게 함 (예: "매주 월, 수, 금 21:00 보스").
*   **핵심 전략:** UI 우선 구현 후 데이터 및 로직 연결.
*   **요일 기준:** 일요일(0) ~ 토요일(6) 순서.
*   **체크 완료:** 완료 되고, 사용자가 검증을 완료 하면, 체크 리스트를 완료로 변경.

---

### **0단계: UI/UX 구현 (UI-First)**

<details>
<summary><strong>✅ 0.1. 리스트 및 모달 UI 기본 구조 구현</strong></summary>

- [x] **완료:** 고정 알림 목록을 감싸는 카드 UI를 구현함. (`.card-standard`)
- [x] **완료:** 목록 내 각 항목의 기본 스타일을 정의함. (`.list-item`, `.fixed-alarm-item`)
- [x] **완료:** '추가/편집'을 위한 모달의 기본 HTML/CSS 뼈대를 구현함. (`#fixed-alarm-modal`)
- [x] **완료:** 모달 열기/닫기 기본 로직을 구현함. (`settings.js`)
</details>

<details>
<summary><strong>✅ 0.2. 요일 선택 UI 컴포넌트 구현</strong></summary>

- [x] **완료:** 목록과 모달 내부에 '일'~'토' 7개의 원형 요일 버튼(`day-button`) UI를 구현함.
- [x] **완료:** 버튼의 기본 및 활성(`active`) 상태에 대한 CSS 스타일을 적용함.
</details>

<details open>
<summary><strong>✅ 0.3. 고정 알림 목록에 요일 정보 표시</strong></summary>

- [x] **사전 분석:** `renderFixedAlarms` 함수는 `alarm.days` 배열을 기반으로, 각 알림 항목의 2번째 줄에 7개의 요일 버튼 UI를 표시해야 합니다.
- [x] **실행 계획:**
    *   `src/ui-renderer.js`의 `renderFixedAlarms` 함수가 `alarm.days` 데이터에 따라 요일 버튼의 `active` 클래스를 동적으로 부여하도록 수정함.
    *   목록의 요일 버튼이 클릭되지 않도록 CSS에서 `pointer-events: none` 처리함.
- [x] **검증:** 사용자가 직접 확인하고 다음 단계로 진행을 승인함.
</details>

---

### **1단계: 데이터 구조 및 로직 (준비)**

<details open>
<summary><strong>✅ 1.1. 데이터 구조 확장 및 마이그레이션</strong></summary>

- [x] **사전 분석:** 기존 알람 객체에 `days` 속성이 없으므로 추가해야 합니다.
- [x] **실행 계획:**
    *   `src/data-managers.js`의 `loadFixedAlarms` 함수를 수정하여, 로드된 각 알람 객체에 `days` 속성이 없으면 기본값으로 `[0, 1, 2, 3, 4, 5, 6]`을 할당함.
    *   `getFixedAlarmById(id)` 헬퍼 함수를 추가함.
- [x] **검증:** 사용자가 직접 확인하고 다음 단계로 진행을 승인함.
</details>

---

### **2단계: 핵심 로직 연결 (UI <-> Data)**

<details open>
<summary><strong>✅ 2.1. 모달 - 데이터 연동 (로드 및 상호작용)</strong></summary>

- [x] **사전 분석:** '편집' 시 기존 데이터를, '추가' 시 초기 데이터를 모달에 채워야 합니다. 또한, 모달 내 요일 버튼 클릭에 반응해야 합니다.
- [x] **실행 계획:**
    *   `src/screens/settings.js`의 `openFixedAlarmModal` 함수가 '편집' 시 기존 데이터를, '추가' 시 초기 데이터를 모달에 채우도록 구현함.
    *   모달 내 요일 버튼 클릭 시 `.active` 클래스를 토글하는 상호작용을 구현함.
- [x] **검증:** 사용자가 직접 확인하고 다음 단계로 진행을 승인함.
</details>

<details open>
<summary><strong>✅ 2.2. 모달 - '저장' 로직 구현</strong></summary>

- [x] **사전 분석:** '추가'와 '편집'을 구분하여 `LocalStorageManager`의 함수를 호출해야 합니다. 기존의 유효성 검사 로직을 반드시 재사용해야 합니다.
- [x] **실행 계획:**
    *   '저장' 버튼 리스너가 '추가'/'편집' 모드를 구분하여 동작하도록 구현함.
    *   기존 유효성 검사, 데이터 정규화 로직을 재사용함.
    *   `LocalStorageManager`를 사용하여 데이터를 저장하고, UI 새로고침 및 워커 동기화 등 후속 처리를 구현함.
    *   알람이 실행 중이면 `syncScheduleToWorker()`를 호출하여 워커에 변경사항을 동기화합니다.
- [x] **검증:** 사용자가 직접 확인하고 다음 단계로 진행을 승인함.
</details>

---

### **3단계: 스케줄링 로직 고도화**

<details open>
<summary><strong>✅ 3.1. 요일을 고려한 다음 알림 시간 계산</strong></summary>

- [x] **사전 분석:** `alarm-scheduler.js`에서 워커로 데이터를 보낼 때, 요일을 고려하여 미래 시간을 계산해야 합니다.
- [x] **실행 계획:**
    *   `src/utils.js`: `calculateNextOccurrence(alarm, baseDate)` 헬퍼 함수를 구현하여, `alarm` 객체의 `days` 속성을 기반으로 다음 알림 발생 시간을 계산합니다.
    *   `src/alarm-scheduler.js`: `addAlarmsToFlatSchedule` 및 `calculateNextBoss` 함수에서 `calculateNextOccurrence`를 호출하여 고정 알림의 다음 발생 시간을 결정합니다.
- [x] **검증:** 요일별 알림이 정확한 날짜/시간으로 대시보드에 표시되는지, 워커가 제때 알림을 보내는지 확인.
</details>

---

### **4단계: 통합 테스트**

<details open>
<summary><strong>✅ 4.1. 시나리오 테스트</strong></summary>

- [x] **검증:**
    1.  특정 요일(예: 화)만 선택한 고정 알림 추가.
    2.  대시보드 '다음 보스'에 해당 알림이 올바른 날짜/시간으로 표시되는지 확인.
    3.  알림이 해당 요일에만 울리는지 확인.
- [x] **결과:** 사용자가 직접 시나리오 테스트를 진행하여 모든 기능이 정상적으로 동작함을 확인했습니다.
</details>
