---
status: 미해결
created_at: 2025-11-25
priority: medium
assigned_to: Gemini
labels:
  - bug
  - boss-scheduler
  - defer
---
# 이슈 006: 보스 스케줄러 시간 적용 버그

## 1. 문제점

보스 스케줄러 기능 사용 중 다음과 같은 심각한 문제가 보고되었습니다.

-   **현상:** 보스 스케줄러 화면에서 각 보스의 남은 시간을 입력한 후 '보스 설정 적용' 버튼을 클릭했을 때, 보스 목록의 시간 순서가 뒤섞이거나 날짜가 의도치 않게 변경되는 현상이 발생합니다.

-   **상세 내용:**
    *   초기에는 텍스트 영역의 시간을 단순히 `Date` 객체에 더하는 방식으로 처리되어, 현재 시간보다 이른 시간을 입력할 경우 날짜가 다음 날로 자동 롤오버되는 문제가 있었습니다.
    *   또한, `Date` 객체의 로컬 시간 메서드와 UTC 메서드가 혼용되어 사용될 때 발생하는 시간대 불일치 문제로 인해, 특히 한국 표준시(KST, UTC+9) 환경에서 예상과 다른 시간으로 인식되거나 정렬되는 버그가 확인되었습니다.
    *   **재현 케이스 (예시):**
        ```
        # 초기 보스 목록 (11월 28일 기준)
        11.28
        09:24 우로보로스
        ...
        11:01 셀로비아
        ...
        23:48 바우티
        11.29
        00:00 파르바
        ...
        ```
        이 상태에서 사용자가 젠 계산기(또는 스케줄러 입력)에서 "11:01 셀로비아"의 시간을 "10:50:13 셀로비아"로 업데이트하고 '보스 설정 적용' 버튼을 눌렀을 때, `DOM.bossListInput`에는 다음과 같이 표시되었습니다.

        ```
        # '보스 설정 적용' 후 목록
        11.28
        11:00 페티
        11:01 브륀힐드
        11:01 수드리
        11.29
        00:00 파르바
        00:12 라이노르
        ...
        03:28 라타토스크
        10:50:13 셀로비아  # <-- 이 항목이 11.29 항목들 뒤, 하지만 11.28 항목들 앞에 잘못 위치함
        11:01 지감7층
        ...
        ```
        이는 "10:50:13 셀로비아" 항목이 파서에 의해 `11.29`의 시간으로 잘못 해석되어 내부적으로 저장되었고, 이로 인해 전체 목록의 정렬 순서가 뒤틀리는 현상을 야기했습니다. 근본적인 원인은 `Date` 객체 처리 및 시간대 불일치였습니다.

## 2. 현재 상황

현재 프로젝트 전반에 걸친 아키텍처 리팩토링 작업(v4.0)이 진행 중입니다. 리팩토링 과정에서 관련 로직(`boss-scheduler.js` 등)이 변경되고 있으므로, 즉각적인 디버깅보다는 리팩토링 완료 후 안정화 단계에서 처리하는 것이 효율적이라고 판단했으나, 해당 버그의 심각성을 고려하여 우선적으로 해결을 시도하고 있습니다.

## 3. 해결 진행 및 향후 계획

1.  **초기 디버깅 및 분석:** `boss-scheduler.js`의 `moveToBossSettingsButton` 핸들러에서 `remainingTime`을 시간 *지속 시간*으로 잘못 해석하는 문제와 `Date` 객체 생성 및 `setHours`/`getHours` 메서드 사용 시 발생하는 시간대 불일치 문제를 식별했습니다.
2.  **UTC 중심 접근 시도:** 초기에는 애플리케이션의 내부 로직을 UTC(협정 세계시)를 기준으로 일관되게 처리하도록 `Date.UTC()`, `setUTCHours()` 등의 메서드를 사용하여 문제를 해결하려 했습니다.
3.  **KST 중심 접근으로 전환:** 한국 사용자만을 위한 애플리케이션이라는 요구사항을 고려하여, 모든 계산 및 표시가 한국 표준시(KST, UTC+9)를 기준으로 이루어지도록 로직을 수정하는 방향으로 전환했습니다.
4.  **`BossDataManager` 직접 업데이트 로직 구현:** `boss-scheduler.js`에서 텍스트 기반으로 `BossDataManager`를 재생성하고 재파싱하는 대신, `BossDataManager`의 기존 일정에 처리된 보스 데이터를 직접 병합하여 업데이트하는 로직을 구현했습니다. 이를 통해 `type: 'date'` 항목과 처리되지 않은 보스들의 데이터가 유지되도록 했습니다.
5.  **테스트 환경 재설정 및 보강:**
    *   `test/boss-scheduler.test.js`에 강력한 `EventBus` 및 `BossDataManager` 모의를 구현하여 테스트 환경을 실제와 유사하게 구성했습니다.
    *   `mockBossSchedule`을 현실적인 데이터로 초기화하여 `BossDataManager`가 빈 상태로 시작하지 않도록 했습니다.
    *   `process.env.TZ = 'UTC';` 설정을 사용하여 테스트 환경의 시간대 일관성을 확보했습니다.
6.  **현재 상태:**
    *   위의 수정 사항들이 적용되었으나, `test/boss-scheduler.test.js`의 여러 테스트가 여전히 실패하고 있습니다. 특히 `updateBossListTextarea` 함수가 `DOM.bossListInput.value`에 올바른 보스 목록 텍스트를 렌더링하지 못하여 빈 문자열을 반환하는 문제가 남아있습니다.
    *   이러한 **현재 미해결 문제점과 그에 대한 상세 분석 및 디버깅 과정은 [이슈 008: 보스 스케줄러 기능 및 테스트의 지속적인 문제점](issue-008-boss-scheduler-testing-problems.md)에 상세히 기록되어 있습니다.**