---
id: issue-007
title: "다음 보스 계산 로직 날짜 구분 오류"
status: "해결됨"
priority: "High"
assignee: "Gemini"
labels:
  - bug
  - logic
  - boss-scheduler
created_date: "2025-11-26"
resolved_date: ""
---
# Issue-007: 다음 보스 계산 로직 날짜 구분 오류

## 1. 문제점

대시보드 및 보스 스케줄러에서 '다음 보스'를 계산할 때, 보스의 출현 날짜를 정확하게 고려하지 않고 시간만으로 비교하여 잘못된 보스를 표시하는 문제가 발견되었습니다.

### 재현 시나리오 (예시)
- **현재 날짜:** 11월 26일
- **보스 목록:**
  1. `11.26 11:00 보스A` (오늘 오전 11시)
  2. `11.27 05:33 보스B` (내일 새벽 5시 33분)
- **기대 결과:** 현재 시간이 11월 26일 10:00라면, 다음 보스는 '보스A'여야 합니다.
- **실제 결과:** '보스B' (05:33)가 '보스A' (11:00)보다 시간 수치가 작기 때문에 더 이른 보스로 잘못 인식되어 '다음 보스'로 표시됩니다.

## 2. 원인 추정

- 보스 데이터를 정렬하거나 비교하는 로직에서 `Date` 객체의 전체 타임스탬프가 아닌, 시간(`HH:MM`) 문자열만 비교하고 있을 가능성이 높습니다.
- 또는 날짜 변경선(자정)을 넘가는 계산 로직에 오류가 있을 수 있습니다.

## 3. 향후 계획

1.  **리팩토링 완료 대기:** 현재 진행 중인 아키텍처 리팩토링(v4.0)을 우선 완료하여 코드 베이스를 안정화합니다.
2.  **로직 분석 및 수정:** `BossDataManager` 및 `alarm-scheduler.js`의 다음 보스 계산 로직을 정밀 분석합니다. 날짜와 시간을 결합한 `Date` 객체 또는 타임스탬프를 기준으로 정렬하도록 수정합니다.
3.  **테스트:** 날짜가 다른 여러 보스가 섞여 있는 상황에 대한 테스트 케이스를 추가하여 검증합니다.

## 4. 해결 (Resolution)

### 문제의 원인
'다음 보스' 계산 로직이 보스 데이터의 전체 날짜/시간(Date 객체)을 고려하지 않고 시간 문자열(`HH:MM:SS`)만을 기준으로 비교 및 정렬하여, 날짜를 넘나드는 보스 스케줄에서 잘못된 '다음 보스'를 식별하는 문제가 있었습니다. 특히, '오늘 11:00 보스A'와 '내일 05:33 보스B'가 있을 때, 현재 시간이 '오늘 10:00'임에도 '보스B'를 '다음 보스'로 잘못 인식하는 경우가 발생했습니다.

### 해결 방안
1.  **`alarm-scheduler.js`의 `checkAlarms()` 함수 수정:**
    *   `allAlarms` 배열을 구성할 때 `BossDataManager`의 보스 데이터가 가진 정확한 `scheduledDate`(`Date` 객체)를 직접 사용하고, 고정 알람(`fixedAlarms`)의 경우에도 현재 시간을 기준으로 올바른 `scheduledDate`를 계산하여 포함하도록 변경했습니다.
    *   `allAlarms` 배열을 각 알람 객체의 `scheduledDate` (전체 타임스탬프)를 기준으로 정렬하도록 수정하여, 날짜를 넘나드는 보스들의 시간 순서를 정확하게 반영하도록 했습니다.
    *   `potentialNextAlarms` 결정 로직을 간소화하여, 이미 `scheduledDate`를 기준으로 정확히 정렬된 `allAlarms`에서 현재 시간 이후의 보스만 필터링한 후 첫 번째 요소를 '다음 보스'로 지정하도록 했습니다.

이러한 수정으로 인해 애플리케이션은 보스 스케줄의 날짜 정보를 올바르게 처리하고, 모든 상황에서 '다음 보스'를 정확하게 계산하고 표시합니다.