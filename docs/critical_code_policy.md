# 핵심 코드 수정 정책 (Critical Code Modification Policy)

## 1. 절대 원칙

### 1.1. 핵심 로직 수정 금지
다음 파일들의 **핵심 로직**은 사용자님의 **명시적 승인 없이 절대 수정하지 않는다:**

| 파일 | 핵심 영역 |
|------|----------|
| `src/data-managers.js` | `BossDataManager`, `LocalStorageManager` 전체 |
| `src/boss-parser.js` | `parseBossList`, 날짜/시간 파싱 로직 |
| `src/app.js` | `processBossItems`, `loadInitialData` |
| `src/screens/boss-scheduler.js` | `syncInputToText`, `syncTextToInput`, `handleApplyBossSettings` |
| `src/ui-renderer.js` | `renderBossInputs`, `updateBossListTextarea` |

### 1.2. 수정 전 필수 절차
1. **변경 의도 설명:** 무엇을, 왜 바꾸려는지 사용자님께 먼저 설명
2. **영향 범위 분석:** 해당 변경이 다른 기능에 미치는 영향 분석 제시
3. **사용자 승인:** 사용자님의 명시적 `진행` 승인 후에만 코드 수정

### 1.3. 금지 행위
- 린트 오류 수정을 구실로 핵심 로직 변경
- "최적화"를 이유로 기존 동작 방식 변경
- 사용자 요청 없이 리팩토링 진행
- 기존 함수의 역할/책임 변경

## 2. SSOT 원칙 (절대 불변)

### 2.1. 데이터 흐름
```
[JSON 파일] → processBossItems → [Main SSOT] → [Draft] → [UI]
[사용자 입력] → [Draft] → commitDraft → [Main SSOT]
```

### 2.2. 핵심 규칙
- **버전 데이터 표준화 (SSOT)**: `window.APP_VERSION` 값은 **숫자로만 관리**한다 (예: `"2.17.0"`). 출력 시 'v' 접두사는 UI 레이어에서 처리하며, 데이터 연산 및 비교는 순수 숫자 문자열을 기준으로 삼는다.
- **기준(GEMINI) vs 절차(Workshop) 이원화**: 에이전트 작업 시 `GEMINI.md`는 기술적 기준을 제시하고, 워크플로우 파일은 실행 절차를 담당한다. 에이전트는 항상 기준을 참조하여 절차를 수행해야 한다.
- **출력은 항상 SSOT(또는 Draft)를 바탕으로**: 화면 로딩 시 분 단위 남은 시간에서 역계산하지 말고, `scheduledDate`를 직접 읽어 출력하여 1ms의 오차도 허용하지 않음.
- **입력은 SSOT 형식에 맞게 변환하여 업데이트**: 사용자가 입력을 마치는 시점에만 새로운 `scheduledDate`를 계산하여 반영.
- **시간 역전 감지**: 이전 보스보다 시간이 이르면 다음 날로 처리.
- **과거 데이터 자동 정제 (Data Diet)**: `_expandAndReconstruct` 로직은 서비스 성능 및 메모리 효율을 위해 오늘 00:00 이전의 보스 인스턴스를 자동으로 제거한다. 단, 사용자가 직접 입력한 '가장 가까운 미래의 앵커'는 유실 방지를 위해 48시간 윈도우 밖이라도 항상 보호한다.
- **이름 기반 매칭 및 정합성 (v2.17.2)**: 간편 모드에서는 이름을 키로 매칭하며, 프리셋 정합성 검사 시 보스 인스턴스의 개수가 아닌 **보스 종류(Type)**를 기준으로 일치 여부를 판단하여 유령 보스 유입을 원천 차단한다. 이를 통해 일부 보스 시간만 입력된 경우에도 프리셋 모드가 유지되도록 개선했다. 중복 시 현재 시각에 가장 가까운 항목을 선택한다.
- **음수 시간 지원**: `-HH:MM` 형식의 과거 시간을 허용하고 정확한 과거 시점 계산.

## 3. 위반 시
- 해당 변경 즉시 롤백
- 원인 분석 및 이슈 등록
- 재발 방지 대책 수립
